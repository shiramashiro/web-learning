<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>03.树形控件</title>
  <link rel="stylesheet" href="./index.css">
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
</head>
<body>
<div id="app">
</div>
<script type="text/javascript">
  function strToBool(str) {
    return str !== "false";
  }

  function boolToStr(bool) {
    return bool === false ? "false" : "true";
  }

  let treeOcxData = [
    {
      tip: "分类",
      child: [
        {
          tip: "设计作品",
          child: [
            {
              tip: "作品1"
            },
            {
              tip: "作品2"
            }
          ]
        },
        {
          tip: "技巧杂烩",
          child: [
            {
              tip: "Web 前端",
              child: [ { tip: "Vue.js" }, { tip: "JavaScript" },
                {
                  tip: "HTML",
                  child: [
                    {
                      tip: "Canvas",
                      child: [ { tip: "beginPath()" }, { tip: "closePath()" } ]
                    },
                    { tip: "Audio" }
                  ]
                }
              ]
            },
            {
              tip: "Python"
            },
            {
              tip: "Java"
            }
          ]
        },
        {
          tip: "生活随笔"
        },
        {
          tip: "兴趣爱好"
        }
      ]
    },
    {
      tip: "导航",
      child: [ { tip: "固钉" }, { tip: "回到顶部" }, { tip: "面包屑" } ]
    },
    {
      tip: "数据展示"
    }
  ];

  function rendTreeOcx(data, enableFold) {
    let template = `<ul class="tree-ocx-ul">`;
    if ( enableFold ) template = `<ul class="tree-ocx-ul tree-ocx-ul-enable-fold">`;

    for ( let i = 0; i < data.length; i++ ) {
      if ( data[i].child ) {
        template += `
          <li class="tree-ocx-li tree-ocx-li-enable-fold" data-displayed="false">
            <div class="tree-ocx-tip">${ data[i].tip }</div>
            ${ rendTreeOcx(data[i].child, true) }
        `;
      } else {
        template += `
          <li class="tree-ocx-li">
            <div class="tree-ocx-tip">${ data[i].tip }</div>
        `;
      }
      template += `</li>`;
    }
    template += `</ul>`;
    return template;
  }

  $("#app").append(rendTreeOcx(treeOcxData));

  foldOrUnFoldTree();

  function foldOrUnFoldTree() {
    $(".tree-ocx-li").on("click", function (e) {
      e.stopPropagation();

      let displayed = strToBool($(this)[0].dataset.displayed);
      if ( displayed === false ) {
        $(this).css({
          "--tree-ocx-tip-height": `${ $(this).children(".tree-ocx-tip").height() }px`,
          "--tree-ocx-li-height": `${ $(this).children(".tree-ocx-ul-enable-fold").height() }px`
        });
        $(this).addClass("tree-ocx-li-enable-fold-active");
        $(this).children(".tree-ocx-ul-enable-fold").addClass("tree-ocx-ul-enable-fold-active");
      } else {
        $(this).removeClass("tree-ocx-li-enable-fold-active");
        $(this).children(".tree-ocx-ul-enable-fold").removeClass("tree-ocx-ul-enable-fold-active");
      }
      $(this)[0].dataset.displayed = boolToStr(!displayed);
    });
  }
</script>
</body>
</html>