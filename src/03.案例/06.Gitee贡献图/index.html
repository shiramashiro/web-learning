<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>贡献图</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
</head>
<style>
  #contribution-chart {
    height: 100px;
    display: flex;
    flex-direction: row;
  }

  #contribution-chart .left-side,
  #contribution-chart .right-side {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  #contribution-chart .left-side {
    width: 10%;
  }

  #contribution-chart .right-side {
    width: 90%;
    flex-wrap: wrap;
    align-content: flex-start;
  }

  .right-side .diamond {
    width: var(--diamond-size);
    height: var(--diamond-size);
    border: 1px solid #FFF;
    box-sizing: border-box;
    background-color: white;
  }
</style>
<body>
  <div id="contribution-chart">
    <div class="left-side">
      <div class="week">周一</div>
      <div class="week">周四</div>
      <div class="week">周日</div>
    </div>
    <div class="right-side" data-diamond-size="0"></div>
  </div>
  <script>
    let diamondData = [
      {
        date: "2021-6-29",
        num: 1
      },
      {
        date: "2021-6-30",
        num: 2
      },
      {
        date: "2021-7-1",
        num: 0
      },
      {
        date: "2021-7-2",
        num: 4
      },
      {
        date: "2021-7-3",
        num: 6
      },
      {
        date: "2021-7-4",
        num: 0
      },
      {
        date: "2021-7-5",
        num: 0
      },
      {
        date: "2021-7-6",
        num: 12
      },
      {
        date: "2021-7-7",
        num: 0
      },
      {
        date: "2021-7-8",
        num: 0
      },
      {
        date: "2021-7-9",
        num: 4
      },
      {
        date: "2021-7-10",
        num: 0
      },
      {
        date: "2021-7-11",
        num: 0
      },
      {
        date: "2021-7-12",
        num: 4
      },
      {
        date: "2021-7-13",
        num: 15
      }
    ];

    function drawChartGrid() {
      let $rightSide = $("#contribution-chart .right-side");
      let diamondSize = $rightSide.height() / 7;
      let index = 0;
      for ( let horizontal = 0; horizontal < 53; horizontal++ ) {
        for ( let vertical = 0; vertical < 7; vertical++ ) {
          $rightSide.css({ "--diamond-size": `${ diamondSize }px` });
          $rightSide.append(`<div class="diamond" data-index="${ index }" data-content=""></div>`);
          index++;
        }
      }
    }

    // 根据贡献数量设置小方块的颜色
    function setDiamondColor(dom, num) {
      if ( num <= 0 ) {
        $(dom).css({ "background-color": "#EEEEEE" });
      } else if ( num <= 5 ) {
        $(dom).css({ "background-color": "#D6E685" });
      } else if ( num > 11 ) {
        $(dom).css({ "background-color": "#8CC665" });
      } else if ( num > 16 ) {
        $(dom).css({ "background-color": "#44A340" });
      } else if ( num > 21 ) {
        $(dom).css({ "background-color": "#1E6823" });
      } else {
        $(dom).css({ "background-color": "#EEEEEE" });
      }
    }

    function getAYearAgoToday(date) {
      let year = date.getFullYear() - 1;
      let month = date.getMonth() + 1;
      let day = date.getDate();
      return new Date(`${ year }-${ month }-${ day }`);
    }

    function calcWeekOfYearAgoToday() {
      let aYearAgoDate = getAYearAgoToday(new Date());
      let extraWeek = 0;
      $(`#contribution-chart .right-side .diamond`).each(function (index, element) {
        if ( index === 366 + extraWeek - 2 ) {
          return false;
        } else if ( index >= aYearAgoDate.getDay() ) {
          if ( diamondData[index] ) {
            $(element)[0].dataset.content = `${ diamondData[index].num }个贡献：${ diamondData[index].date }`;
            setDiamondColor(element, diamondData[index].num);
          } else {
            $(element).css({ "background-color": "#EEEEEE" });
          }
        } else {
          extraWeek++;
        }
      });
    }

    drawChartGrid();
    calcWeekOfYearAgoToday();
  </script>
</body>
</html>